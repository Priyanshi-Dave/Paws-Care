<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Appointment Reminders | Paws-Care</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  background:#0b1f3a;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Segoe UI, sans-serif;
}

.card {
  width:440px;
  border-radius:20px;
}
</style>
</head>

<body>

<div class="card p-4">
  <h4 class="text-center">‚è∞ Appointment Reminders</h4>
  <p class="text-muted text-center">Choose when you want to be reminded</p>

  <div class="form-check">
    <input class="form-check-input" type="checkbox" value="1440" id="r1">
    <label class="form-check-label" for="r1">
      1 Day Before
    </label>
  </div>

  <div class="form-check">
    <input class="form-check-input" type="checkbox" value="60" id="r2">
    <label class="form-check-label" for="r2">
      1 Hour Before
    </label>
  </div>

  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" value="30" id="r3">
    <label class="form-check-label" for="r3">
      30 Minutes Before
    </label>
  </div>

  <button class="btn btn-success w-100" onclick="setReminders()">
    Activate Reminders
  </button>
</div>

<script>
// Request notification permission
if ("Notification" in window) {
  Notification.requestPermission();
}

function setReminders() {
  const booking = JSON.parse(localStorage.getItem("booking"));

  if (!booking) {
    alert("No appointment found.");
    return;
  }

  const appointmentTime = new Date(
    booking.date + "T" + booking.time
  ).getTime();

  const selectedReminders = document.querySelectorAll("input[type=checkbox]:checked");

  if (selectedReminders.length === 0) {
    alert("Please select at least one reminder time.");
    return;
  }

  selectedReminders.forEach(reminder => {
    const minutesBefore = reminder.value;
    const reminderTime = appointmentTime - (minutesBefore * 60 * 1000);
    const delay = reminderTime - new Date().getTime();

    if (delay > 0) {
      setTimeout(() => {
        showReminder(booking, minutesBefore);
      }, delay);
    }
  });

  alert("Selected reminders have been scheduled!");
  window.location.href = "Default.html";
}

function showReminder(booking, minutes) {
  const message = `Your ${booking.service} appointment is in ${minutes} minutes.`;

  if (Notification.permission === "granted") {
    new Notification("üêæ Paws-Care Reminder", { body: message });
  }

  alert("Reminder:\n" + message);
}
</script>

</body>
</html>