<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pet Hospitals Map | Ahmedabad</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
  background:#0b1f3a;
  font-family:Segoe UI, sans-serif;
}

#map {
  height:70vh;
  border-radius:15px;
}

select {
  border-radius:10px;
}
</style>
</head>

<body>

<div class="container py-3">
  <h4 class="text-center text-white mb-3">
    ğŸ¾ Pet Hospitals & Clinics â€“ Ahmedabad
  </h4>

  <!-- Controls -->
  <div class="row mb-3">
    <div class="col-md-6 mb-2">
      <select id="areaFilter" class="form-select" onchange="filterByArea()">
        <option value="all">Filter by Area</option>
        <option value="Bopal">Bopal</option>
        <option value="Nikol">Nikol</option>
        <option value="Thaltej">Thaltej</option>
        <option value="Maninagar">Maninagar</option>
        <option value="Naroda">Naroda</option>
      </select>
    </div>
    <div class="col-md-6">
      <button class="btn btn-warning w-100" onclick="findNearestClinic()">
        ğŸš‘ Find Nearest Emergency Clinic
      </button>
    </div>
  </div>

  <!-- Map -->
  <div class="card p-2">
    <div id="map"></div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Map setup
const map = L.map('map').setView([23.0225, 72.5714], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'Â© OpenStreetMap contributors'
}).addTo(map);

// Icons
const hospitalIcon = L.icon({
  iconUrl:'https://cdn-icons-png.flaticon.com/512/616/616408.png',
  iconSize:[30,30]
});

const userIcon = L.icon({
  iconUrl:'https://cdn-icons-png.flaticon.com/512/149/149071.png',
  iconSize:[30,30]
});

// Hospital data
const hospitals = [
  { name:"Sneh Pet Hospital", area:"Thaltej", lat:23.0508, lng:72.5116 },
  { name:"PETCLANS Vet Hospital", area:"Bopal", lat:23.0024, lng:72.4689 },
  { name:"PetVet Clinic", area:"Maninagar", lat:22.9981, lng:72.6030 },
  { name:"Vet 4 Pets", area:"Naroda", lat:23.0742, lng:72.6570 },
  { name:"The Pet Hospital", area:"Nikol", lat:23.0469, lng:72.6533 },
  { name:"SPCA Veterinary Hospital", area:"Ellis Bridge", lat:23.0264, lng:72.5711 }
];

let markers = [];
let userLocation = null;

// Load hospitals
function loadHospitals(data) {
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  data.forEach(h => {
    const marker = L.marker([h.lat, h.lng], {icon:hospitalIcon})
      .addTo(map)
      .bindPopup(`<b>${h.name}</b><br>${h.area}`);
    markers.push(marker);
  });
}
loadHospitals(hospitals);

// Area filter
function filterByArea() {
  const area = document.getElementById("areaFilter").value;
  if (area === "all") {
    loadHospitals(hospitals);
  } else {
    loadHospitals(hospitals.filter(h => h.area === area));
  }
}

// Get user location
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => {
    userLocation = [pos.coords.latitude, pos.coords.longitude];
    L.marker(userLocation, {icon:userIcon})
      .addTo(map)
      .bindPopup("ğŸ“ You are here")
      .openPopup();
  });
}

// Distance calculation
function distance(lat1,lng1,lat2,lng2){
  return Math.sqrt((lat1-lat2)**2 + (lng1-lng2)**2);
}

// Find nearest clinic
function findNearestClinic(){
  if(!userLocation){
    alert("Location not available");
    return;
  }

  let nearest = null;
  let minDist = Infinity;

  hospitals.forEach(h => {
    const d = distance(userLocation[0], userLocation[1], h.lat, h.lng);
    if (d < minDist) {
      minDist = d;
      nearest = h;
    }
  });

  if(nearest){
    map.setView([nearest.lat, nearest.lng], 14);
    L.popup()
      .setLatLng([nearest.lat, nearest.lng])
      .setContent(`ğŸš‘ <b>Nearest Emergency Clinic</b><br>${nearest.name}`)
      .openOn(map);
  }
}
</script>

</body>
</html>
